<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Les yeux ‚Äî mini jeu Junji Ito (Spirale)</title>

  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&family=Roboto+Mono:wght@300;400&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #050505;
      --blood: #b00020;
      --blood-soft: #4b0010;
      --text: #f5f5f5;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: radial-gradient(circle at center, #141414 0%, #050505 55%, #000 100%);
      min-height: 100vh;
      overflow: hidden;
      font-family: "Cormorant Garamond", serif;
      color: var(--text);
      position: relative;
    }

    /* Grain + lignes inqui√©tantes */
    body::before {
      content: "";
      position: fixed;
      inset: -40px;
      pointer-events: none;
      background:
        repeating-linear-gradient(
          to bottom,
          rgba(255, 255, 255, 0.02) 0px,
          rgba(255, 255, 255, 0.01) 2px,
          rgba(0, 0, 0, 0.4) 4px
        );
      mix-blend-mode: soft-light;
      opacity: 0.7;
      animation: drift 35s linear infinite;
      z-index: 1;
    }

    @keyframes drift {
      0% { transform: translateY(0); }
      100% { transform: translateY(200px); }
    }

    @keyframes breathe {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.005); }
    }

    @keyframes vignettePulse {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 0.6; }
    }

    /* Vignette sombre qui pulse */
    body::after {
      content: "";
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at center, transparent 0%, rgba(0,0,0,0.9) 100%);
      pointer-events: none;
      z-index: 1;
      animation: vignettePulse 8s ease-in-out infinite;
    }

    #scene {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      animation: breathe 12s ease-in-out infinite;
      cursor: crosshair;
      z-index: 2;
    }

    /* Spirale centrale am√©lior√©e */
    #spiral-bg {
      position: absolute;
      width: 420px;
      height: 420px;
      border-radius: 50%;
      border: 3px solid rgba(176, 0, 32, 0.2);
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 
        0 0 80px rgba(176, 0, 32, 0.4),
        inset 0 0 60px rgba(0,0,0,0.9);
      opacity: 0.5;
      overflow: visible;
      pointer-events: none;
    }

    #spiral-bg::before,
    #spiral-bg::after {
      content: "";
      position: absolute;
      border-radius: 50%;
      border: 2px dashed rgba(176, 0, 32, 0.3);
    }

    #spiral-bg::before {
      inset: 22px;
      animation: rotateReverse 30s linear infinite;
    }

    #spiral-bg::after {
      inset: 60px;
      border-style: dotted;
      opacity: 0.7;
      animation: rotateReverse 20s linear infinite;
    }

    @keyframes rotateSpiral {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(720deg); }
    }

    @keyframes rotateReverse {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(-360deg); }
    }

    #spiral-bg {
      animation: rotateSpiral 45s linear infinite;
    }

    /* Particules flottantes (veines, fragments) */
    .particle {
      position: absolute;
      width: 2px;
      height: 20px;
      background: linear-gradient(to bottom, transparent, rgba(176, 0, 32, 0.3), transparent);
      pointer-events: none;
      opacity: 0;
      animation: floatParticle 8s ease-in-out infinite;
    }

    @keyframes floatParticle {
      0% { 
        opacity: 0;
        transform: translateY(100vh) rotate(0deg);
      }
      10% {
        opacity: 0.6;
      }
      90% {
        opacity: 0.6;
      }
      100% { 
        opacity: 0;
        transform: translateY(-20vh) rotate(720deg);
      }
    }

    /* HUD effrayant redesign√© */
    #hud {
      position: fixed;
      top: 16px;
      left: 18px;
      z-index: 3;
      font-family: "Cormorant Garamond", serif;
      font-size: 14px;
      background: linear-gradient(135deg, rgba(10, 0, 0, 0.95), rgba(20, 0, 5, 0.9));
      padding: 14px 18px;
      border-radius: 2px;
      border: 2px solid rgba(176, 0, 32, 0.7);
      box-shadow: 
        0 0 30px rgba(176, 0, 32, 0.5),
        inset 0 0 20px rgba(0, 0, 0, 0.8);
      letter-spacing: 0.05em;
    }

    #hud::before {
      content: "‚ö†";
      position: absolute;
      top: -12px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 20px;
      color: var(--blood);
      text-shadow: 0 0 10px rgba(176, 0, 32, 1);
      animation: warningPulse 2s ease-in-out infinite;
    }

    @keyframes warningPulse {
      0%, 100% { opacity: 0.6; transform: translateX(-50%) scale(1); }
      50% { opacity: 1; transform: translateX(-50%) scale(1.2); }
    }

    #hud span {
      color: var(--blood);
      font-weight: bold;
      text-shadow: 0 0 8px rgba(176, 0, 32, 0.8);
      font-family: "Roboto Mono", monospace;
    }

    #hud .label {
      color: rgba(255, 255, 255, 0.6);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    #sanity-bar {
      margin-top: 10px;
      width: 160px;
      height: 12px;
      background: linear-gradient(to right, rgba(0, 0, 0, 0.9), rgba(20, 0, 0, 0.8));
      border: 2px solid rgba(176, 0, 32, 0.6);
      border-radius: 0;
      overflow: hidden;
      position: relative;
      box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.9);
    }

    #sanity-bar::before {
      content: "";
      position: absolute;
      inset: 0;
      background: repeating-linear-gradient(
        90deg,
        transparent,
        transparent 2px,
        rgba(176, 0, 32, 0.2) 2px,
        rgba(176, 0, 32, 0.2) 4px
      );
      pointer-events: none;
    }

    #sanity-fill {
      height: 100%;
      background: linear-gradient(to right, #8b0000, #ff0000, #ff4444);
      transition: width 0.5s ease;
      box-shadow: 0 0 15px rgba(255, 0, 0, 0.8);
      position: relative;
    }

    #sanity-fill::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(to bottom, rgba(255, 255, 255, 0.3), transparent);
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 0.7; }
    }

    #sanity-label {
      font-size: 10px;
      color: rgba(255, 255, 255, 0.5);
      margin-top: 4px;
      text-align: center;
      letter-spacing: 0.15em;
      font-style: italic;
    }

    #hint {
      position: fixed;
      top: 16px;
      right: 18px;
      z-index: 3;
      font-size: 13px;
      font-family: "Cormorant Garamond", serif;
      background: linear-gradient(135deg, rgba(10, 0, 0, 0.95), rgba(20, 0, 5, 0.9));
      padding: 14px 18px;
      border-radius: 2px;
      border: 2px solid rgba(176, 0, 32, 0.7);
      max-width: 300px;
      text-align: right;
      line-height: 1.5;
      box-shadow: 
        0 0 30px rgba(176, 0, 32, 0.5),
        inset 0 0 20px rgba(0, 0, 0, 0.8);
      font-style: italic;
      color: rgba(255, 200, 200, 0.9);
    }

    #hint::after {
      content: "üëÅ";
      position: absolute;
      bottom: -15px;
      right: 10px;
      font-size: 24px;
      opacity: 0.7;
      animation: eyeBlink 4s ease-in-out infinite;
    }

    @keyframes eyeBlink {
      0%, 48%, 52%, 100% { opacity: 0.7; }
      50% { opacity: 0.1; }
    }

    /* Messages d'√©v√©nements - plus dramatiques */
    #event-message {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 4;
      font-family: "Cormorant Garamond", serif;
      font-size: 22px;
      background: linear-gradient(135deg, rgba(176, 0, 32, 0.3), rgba(100, 0, 20, 0.4));
      padding: 16px 32px;
      border-radius: 0;
      border: 3px double rgba(176, 0, 32, 0.8);
      color: #ff3333;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s;
      text-align: center;
      font-style: italic;
      max-width: 600px;
      text-shadow: 
        0 0 10px rgba(255, 0, 0, 0.8),
        2px 2px 4px rgba(0, 0, 0, 0.9);
      box-shadow: 
        0 0 40px rgba(176, 0, 32, 0.6),
        inset 0 0 30px rgba(0, 0, 0, 0.7);
      letter-spacing: 0.08em;
    }

    #event-message.show {
      opacity: 1;
      animation: messageShake 0.5s ease-in-out;
    }

    @keyframes messageShake {
      0%, 100% { transform: translateX(-50%) translateY(0); }
      25% { transform: translateX(-50%) translateY(-3px); }
      75% { transform: translateX(-50%) translateY(3px); }
    }

    /* ANIMATIONS paupi√®res / iris */
    @keyframes irisPulse {
      0%, 100% {
        transform: scale(1);
        box-shadow: 0 0 18px rgba(176,0,32,0.9);
      }
      50% {
        transform: scale(1.07);
        box-shadow: 0 0 28px rgba(255,0,40,0.95);
      }
    }

    @keyframes blinkTop {
      0%, 82%, 100%   { transform: translateY(0); }
      85%, 90%        { transform: translateY(40%); }
    }

    @keyframes blinkBottom {
      0%, 82%, 100%   { transform: scaleY(-1) translateY(0); }
      85%, 90%        { transform: scaleY(-1) translateY(-40%); }
    }

    @keyframes blinkTopAwake {
      0%, 70%, 100%   { transform: translateY(0); }
      73%, 78%        { transform: translateY(45%); }
    }

    @keyframes blinkBottomAwake {
      0%, 70%, 100%   { transform: scaleY(-1) translateY(0); }
      73%, 78%        { transform: scaleY(-1) translateY(-45%); }
    }

    @keyframes blinkTopCursed {
      0%, 60%, 100%   { transform: translateY(0); }
      63%, 68%        { transform: translateY(50%); }
    }

    @keyframes blinkBottomCursed {
      0%, 60%, 100%   { transform: scaleY(-1) translateY(0); }
      63%, 68%        { transform: scaleY(-1) translateY(-50%); }
    }

    /* ≈íIL */
    .eye {
      position: absolute;
      width: 90px;
      height: 54px;
      border-radius: 50%;
      background: radial-gradient(circle at 50% 50%, #fff 0%, #ccc 40%, #999 65%, #111 100%);
      box-shadow:
        0 0 30px rgba(0, 0, 0, 0.9),
        0 0 12px rgba(176, 0, 32, 0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      transform-origin: center;
      transition: transform 0.2s ease-out, opacity 0.25s; 
      overflow: hidden;
      cursor: pointer;
    }

    .eye::before,
    .eye::after {
      content: "";
      position: absolute;
      left: 0;
      right: 0;
      height: 40%;
      background: radial-gradient(circle at 50% 0%, #111 0%, #050505 40%, transparent 100%);
      opacity: 0.9;
      pointer-events: none;
    }

    .eye::before {
      top: -25%;
      animation: blinkTop 7s ease-in-out infinite;
    }

    .eye::after {
      bottom: -25%;
      transform: scaleY(-1);
      animation: blinkBottom 7s ease-in-out infinite;
    }

    .eye-ball {
      position: relative;
      width: 38px;
      height: 38px;
      border-radius: 50%;
      background: radial-gradient(circle, #660000 0%, #210000 55%, #000 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 0 18px rgba(176,0,32,0.9);
      animation: irisPulse 6s ease-in-out infinite;
    }

    .pupil {
      position: relative;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #000;
      box-shadow: 0 0 18px rgba(255,255,255,0.25);
    }

    .pupil::after {
      content: "";
      position: absolute;
      width: 5px;
      height: 5px;
      border-radius: 50%;
      background: rgba(255,255,255,0.7);
      top: 3px;
      left: 4px;
    }

    /* ≈íil √©veill√© */
    .eye.awake .eye-ball {
      background: radial-gradient(circle, #9b0000 0%, #2b0000 55%, #000 100%);
      box-shadow: 0 0 28px rgba(255,0,0,1);
      animation-duration: 3.2s;
    }

    .eye.awake::before {
      animation: blinkTopAwake 5s ease-in-out infinite;
    }

    .eye.awake::after {
      animation: blinkBottomAwake 5s ease-in-out infinite;
    }

    /* ≈íil maudit (nouveau type) */
    .eye.cursed {
      width: 100px;
      height: 60px;
      filter: hue-rotate(120deg);
    }

    .eye.cursed .eye-ball {
      background: radial-gradient(circle, #6600ff 0%, #1a0033 55%, #000 100%);
      box-shadow: 0 0 35px rgba(150,0,255,1);
      animation-duration: 2s;
      width: 42px;
      height: 42px;
    }

    .eye.cursed::before {
      animation: blinkTopCursed 4s ease-in-out infinite;
    }

    .eye.cursed::after {
      animation: blinkBottomCursed 4s ease-in-out infinite;
    }

    .eye.closed {
      opacity: 0;
      pointer-events: none;
      transform: scale(0.7);
    }

    /* Effet de click sur ≈ìil */
    @keyframes eyeHit {
      0% { transform: scale(1); }
      50% { transform: scale(0.8); filter: brightness(2); }
      100% { transform: scale(0); opacity: 0; }
    }

    .eye.hit {
      animation: eyeHit 0.3s ease-out forwards;
    }

    /* GAME OVER - Plus terrifiant */
    #game-over-overlay {
      position: fixed;
      inset: 0;
      background: 
        radial-gradient(circle at center, rgba(10, 0, 0, 0.98) 0%, rgba(0, 0, 0, 1) 70%),
        repeating-linear-gradient(
          0deg,
          transparent,
          transparent 2px,
          rgba(176, 0, 32, 0.03) 2px,
          rgba(176, 0, 32, 0.03) 4px
        );
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: var(--text);
      z-index: 5;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.8s;
      text-align: center;
      padding: 20px;
    }

    #game-over-overlay.show {
      opacity: 1;
      pointer-events: auto;
      animation: overlayDistort 3s ease-in-out infinite;
    }

    @keyframes overlayDistort {
      0%, 100% { filter: hue-rotate(0deg) brightness(1); }
      50% { filter: hue-rotate(5deg) brightness(0.95); }
    }

    #game-over-overlay h1 {
      font-size: 56px;
      letter-spacing: 0.4em;
      margin-bottom: 24px;
      color: var(--blood);
      text-shadow: 
        0 0 30px rgba(176, 0, 32, 1),
        0 0 60px rgba(176, 0, 32, 0.6),
        4px 4px 8px rgba(0, 0, 0, 1);
      animation: glitchTitle 2s ease-in-out infinite;
      position: relative;
    }

    #game-over-overlay h1::before {
      content: "GAME OVER";
      position: absolute;
      left: 2px;
      text-shadow: -2px 0 #0ff;
      top: 0;
      color: var(--blood);
      overflow: hidden;
      animation: glitch1 0.5s infinite;
    }

    #game-over-overlay h1::after {
      content: "GAME OVER";
      position: absolute;
      left: -2px;
      text-shadow: 2px 0 #f0f;
      top: 0;
      color: var(--blood);
      overflow: hidden;
      animation: glitch2 0.5s infinite;
    }

    @keyframes glitchTitle {
      0%, 90%, 100% { transform: translateX(0); }
      92% { transform: translateX(-3px); }
      94% { transform: translateX(3px); }
    }

    @keyframes glitch1 {
      0% { clip-path: inset(40% 0 61% 0); }
      20% { clip-path: inset(92% 0 1% 0); }
      40% { clip-path: inset(43% 0 1% 0); }
      60% { clip-path: inset(25% 0 58% 0); }
      80% { clip-path: inset(54% 0 7% 0); }
      100% { clip-path: inset(58% 0 43% 0); }
    }

    @keyframes glitch2 {
      0% { clip-path: inset(1% 0 94% 0); }
      20% { clip-path: inset(60% 0 20% 0); }
      40% { clip-path: inset(10% 0 85% 0); }
      60% { clip-path: inset(85% 0 5% 0); }
      80% { clip-path: inset(40% 0 43% 0); }
      100% { clip-path: inset(25% 0 15% 0); }
    }

    #game-over-overlay p {
      font-size: 18px;
      max-width: 520px;
      margin-bottom: 16px;
      line-height: 1.7;
      color: rgba(255, 200, 200, 0.9);
      text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.9);
    }

    #stats {
      font-family: "Roboto Mono", monospace;
      font-size: 15px;
      margin: 20px 0;
      padding: 16px 24px;
      background: linear-gradient(135deg, rgba(176, 0, 32, 0.2), rgba(100, 0, 20, 0.3));
      border: 2px solid rgba(176, 0, 32, 0.5);
      border-radius: 0;
      box-shadow: 
        0 0 30px rgba(176, 0, 32, 0.4),
        inset 0 0 20px rgba(0, 0, 0, 0.8);
      letter-spacing: 0.05em;
    }

    #stats span {
      color: #ff4444;
      font-weight: bold;
      text-shadow: 0 0 10px rgba(255, 0, 0, 0.8);
    }

    #restart {
      margin-top: 14px;
      font-family: "Cormorant Garamond", serif;
      font-size: 16px;
      padding: 12px 28px;
      border-radius: 0;
      border: 3px double var(--blood);
      background: linear-gradient(135deg, rgba(20, 0, 0, 0.9), rgba(10, 0, 0, 0.95));
      color: var(--text);
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      transition: all 0.3s;
      box-shadow: 
        0 0 20px rgba(176, 0, 32, 0.3),
        inset 0 0 10px rgba(0, 0, 0, 0.8);
      position: relative;
    }

    #restart::before {
      content: "‚ü≤";
      position: absolute;
      left: 12px;
      font-size: 20px;
    }

    #restart:hover {
      background: linear-gradient(135deg, rgba(176, 0, 32, 0.4), rgba(100, 0, 20, 0.5));
      box-shadow: 
        0 0 40px rgba(176, 0, 32, 0.8),
        inset 0 0 20px rgba(176, 0, 32, 0.3);
      transform: scale(1.05);
      border-color: #ff3333;
    }

  </style>
</head>
<body>

  <div id="scene">
    <div id="spiral-bg"></div>
  </div>

  <div id="hud">
    <div class="label">Yeux ferm√©s</div>
    <span id="closed-count">0</span>
    <div class="label" style="margin-top: 8px;">Yeux ouverts</div>
    <span id="open-count">0</span> / <span id="max-eyes"></span>
    <div id="sanity-bar">
      <div id="sanity-fill" style="width: 100%;"></div>
    </div>
    <div id="sanity-label">Sant√© Mentale</div>
  </div>

  <div id="hint">
    ¬´ Clique sur les yeux avant qu'ils n'atteignent la spirale... ¬ª<br><br>
    Les yeux maudits rapportent plus de points, mais ils d√©vorent ton esprit.
  </div>

  <div id="event-message"></div>

  <div id="game-over-overlay">
    <h1>GAME OVER</h1>
    <p id="game-over-text"></p>
    <div id="stats"></div>
    <button id="restart">recommencer</button>
  </div>

  <script>
    const scene = document.getElementById("scene");
    const closedCountEl = document.getElementById("closed-count");
    const openCountEl = document.getElementById("open-count");
    const maxEyesEl = document.getElementById("max-eyes");
    const sanityFill = document.getElementById("sanity-fill");
    const overlay = document.getElementById("game-over-overlay");
    const overlayText = document.getElementById("game-over-text");
    const statsEl = document.getElementById("stats");
    const restartBtn = document.getElementById("restart");
    const eventMessage = document.getElementById("event-message");

    // Musique d'ambiance - Style anime horror game
    const backgroundMusic = new Audio();
    backgroundMusic.src = "https://opengameart.org/sites/default/files/Dark%20Descent.mp3";
    backgroundMusic.loop = true;
    backgroundMusic.volume = 0.6;
    backgroundMusic.preload = "auto";
    
    // Debug pour voir si √ßa charge
    backgroundMusic.addEventListener('loadeddata', () => {
      console.log("‚úÖ Musique charg√©e avec succ√®s !");
    });
    backgroundMusic.addEventListener('error', (e) => {
      console.error("‚ùå Erreur de chargement audio:", e);
    });

    let mouseX = window.innerWidth / 2;
    let mouseY = window.innerHeight / 2;
    const smoothingFactor = 0.2; // Augment√© pour plus de fluidit√© (√©tait 0.15)

    let eyes = [];
    let closedCount = 0;
    let openCount = 0;
    let sanity = 100;
    let score = 0;
    let audioStarted = false;

    const maxEyes = 10; // R√©duit pour acc√©l√©rer (√©tait 12)
    const spawnIntervalMs = 1100; // Plus rapide (√©tait 1400)
    let spawnIntervalId = null;
    let gameOver = false;
    let difficulty = 1;

    maxEyesEl.textContent = maxEyes;

    // Cr√©er des particules
    function createParticles() {
      for (let i = 0; i < 15; i++) {
        setTimeout(() => {
          const particle = document.createElement("div");
          particle.classList.add("particle");
          particle.style.left = `${Math.random() * 100}%`;
          particle.style.animationDelay = `${Math.random() * 8}s`;
          particle.style.animationDuration = `${6 + Math.random() * 6}s`;
          scene.appendChild(particle);
        }, i * 200);
      }
    }

    createParticles();

    document.addEventListener("mousemove", (e) => {
      mouseX = e.clientX;
      mouseY = e.clientY;
    });

    function showEvent(text) {
      eventMessage.textContent = text;
      eventMessage.classList.add("show");
      setTimeout(() => {
        eventMessage.classList.remove("show");
      }, 2500);
    }

    function updateSanity(amount) {
      sanity = Math.max(0, Math.min(100, sanity + amount));
      sanityFill.style.width = `${sanity}%`;
      
      if (sanity <= 0 && !gameOver) {
        triggerGameOver("Ta sant√© mentale s'est effondr√©e. Les yeux t'ont consum√© de l'int√©rieur.");
      } else if (sanity <= 25 && sanity > 0) {
        showEvent("Tu sens ton esprit se fragmenter...");
      }
    }

    function createEye() {
      if (gameOver) return;

      const eye = document.createElement("div");
      eye.classList.add("eye");

      // 20% de chance de cr√©er un ≈ìil maudit
      const isCursed = Math.random() < 0.2;
      if (isCursed) {
        eye.classList.add("cursed");
      }

      const eyeBall = document.createElement("div");
      eyeBall.classList.add("eye-ball");

      const pupil = document.createElement("div");
      pupil.classList.add("pupil");

      eyeBall.appendChild(pupil);
      eye.appendChild(eyeBall);
      scene.appendChild(eye);

      const padding = 60;
      const w = window.innerWidth;
      const h = window.innerHeight;
      const centerX = w / 2;
      const centerY = h / 2;
      const minDistanceFromCenter = 250; // Distance minimale de la spirale

      let x, y, distFromCenter;
      
      // Boucle pour √©viter de spawner trop pr√®s du centre
      do {
        x = Math.random() * (w - 2 * padding) + padding;
        y = Math.random() * (h - 2 * padding) + padding;
        const dx = x - centerX;
        const dy = y - centerY;
        distFromCenter = Math.sqrt(dx * dx + dy * dy);
      } while (distFromCenter < minDistanceFromCenter);

      eye.style.left = `${x}px`;
      eye.style.top = `${y}px`;

      const speedBase = (0.08 + Math.random() * 0.06) * difficulty; // Vitesse normale

      const eyeData = {
        el: eye,
        pupil,
        awake: false,
        cursed: isCursed,
        pupilX: 0,
        pupilY: 0,
        x,
        y,
        speedBase
      };

      eyes.push(eyeData);
      openCount++;
      updateHud();

      const awakeTimeout = setTimeout(() => {
        if (!gameOver && !eye.classList.contains("closed")) {
          eye.classList.add("awake");
          eyeData.awake = true;
          if (!isCursed) {
            showEvent("Un ≈ìil s'est √©veill√©...");
          }
          checkGameOver();
        }
      }, 3000 + Math.random() * 2000); // Rythme √©quilibr√©

      eyeData.awakeTimeout = awakeTimeout;

      eye.addEventListener("click", () => {
        if (gameOver || eye.classList.contains("closed")) return;
        
        // D√©marrer la musique au premier clic
        if (!audioStarted) {
          backgroundMusic.play().then(() => {
            audioStarted = true;
            console.log("Musique d√©marr√©e !");
          }).catch(err => console.log("Erreur audio:", err));
        }
        
        // Assurer que la musique continue de jouer
        if (backgroundMusic.paused && audioStarted) {
          backgroundMusic.play().catch(err => console.log(err));
        }
        
        eye.classList.add("hit");
        clearTimeout(awakeTimeout);
        
        // Points et effets selon le type d'≈ìil
        if (isCursed) {
          score += 3;
          updateSanity(-8);
          showEvent("≈íil maudit ferm√© ! +3 points");
        } else if (eyeData.awake) {
          score += 2;
          updateSanity(-3);
        } else {
          score += 1;
          updateSanity(-1);
        }
        
        setTimeout(() => {
          eye.remove();
        }, 300);
        
        openCount--;
        closedCount++;
        updateHud();
      });
    }

    function updateHud() {
      closedCountEl.textContent = closedCount;
      openCountEl.textContent = openCount;
      checkGameOver();
    }

    function checkGameOver() {
      if (openCount >= maxEyes && !gameOver) {
        triggerGameOver("Trop d'yeux ouverts √† la fois. La spirale t'appelle d√©sormais.");
      }
    }

    function triggerGameOver(customText) {
      if (gameOver) return;
      gameOver = true;
      clearInterval(spawnIntervalId);

      // Arr√™ter la musique
      backgroundMusic.pause();
      backgroundMusic.currentTime = 0;

      const textsFallback = [
        "Tu en as ferm√© quelques-uns, mais les autres te regardaient d√©j√† depuis l'int√©rieur.",
        "Tu croyais les faire taire. Ils attendaient seulement que tu clignes des yeux.",
        "Tu n'as pas perdu le jeu. Tu as simplement d√©couvert que tu n'√©tais pas seul devant l'√©cran.",
        "La spirale t'a accept√©. Tu fais maintenant partie de son motif √©ternel.",
        "Chaque ≈ìil que tu as ferm√© √©tait une part de toi-m√™me qui se dissolvait."
      ];

      overlayText.textContent = customText || textsFallback[Math.floor(Math.random() * textsFallback.length)];
      
      statsEl.innerHTML = `
        Score final : <span style="color: var(--blood)">${score}</span><br>
        Yeux ferm√©s : ${closedCount}<br>
        Sant√© mentale restante : ${sanity.toFixed(0)}%
      `;
      
      overlay.classList.add("show");
    }

    function resetGame() {
      gameOver = false;

      eyes.forEach(e => {
        clearTimeout(e.awakeTimeout);
        e.el.remove();
      });
      eyes = [];
      closedCount = 0;
      openCount = 0;
      sanity = 100;
      score = 0;
      difficulty = 1;
      updateHud();
      updateSanity(0);

      overlay.classList.remove("show");

      // Relancer la musique si elle a d√©j√† √©t√© activ√©e
      if (audioStarted) {
        backgroundMusic.currentTime = 0;
        backgroundMusic.play().catch(err => console.log(err));
      }

      spawnIntervalId = setInterval(() => {
        createEye();
        // Augmenter progressivement la difficult√©
        if (closedCount > 0 && closedCount % 12 === 0) {
          difficulty += 0.09;
        }
      }, spawnIntervalMs);
      
      for (let i = 0; i < 3; i++) createEye();
    }

    function animate() {
      const centerX = window.innerWidth / 2;
      const centerY = window.innerHeight / 2;
      const spiralRadius = 140;

      eyes.forEach((eyeData) => {
        const rect = eyeData.el.getBoundingClientRect();
        const eyeCenterX = rect.left + rect.width / 2;
        const eyeCenterY = rect.top + rect.height / 2;

        // mouvement vers la spirale
        const dxCenter = centerX - eyeCenterX;
        const dyCenter = centerY - eyeCenterY;
        const distCenter = Math.sqrt(dxCenter * dxCenter + dyCenter * dyCenter) || 1;

        const speedMultiplier = eyeData.cursed ? 1.7 : (eyeData.awake ? 2.2 : 1.3);
        const speed = eyeData.speedBase * speedMultiplier;

        eyeData.x += (dxCenter / distCenter) * speed * distCenter / 80;
        eyeData.y += (dyCenter / distCenter) * speed * distCenter / 80;

        eyeData.el.style.left = `${eyeData.x}px`;
        eyeData.el.style.top = `${eyeData.y}px`;

        // si trop proche du centre -> GAME OVER "spirale"
        if (!gameOver && distCenter < spiralRadius) {
          const msg = eyeData.cursed 
            ? "Un ≈ìil maudit a atteint la spirale. Tu es maintenant li√© √† son motif √©ternel."
            : "Un ≈ìil a atteint la spirale. Le centre t'a regard√© en retour.";
          triggerGameOver(msg);
        }

        // mouvement de la pupille vers la souris
        const dxMouse = mouseX - eyeCenterX;
        const dyMouse = mouseY - eyeCenterY;
        const angle = Math.atan2(dyMouse, dxMouse);
        const maxOffset = eyeData.cursed ? 11 : (eyeData.awake ? 9 : 7);

        const targetX = Math.cos(angle) * maxOffset;
        const targetY = Math.sin(angle) * maxOffset;

        eyeData.pupilX += (targetX - eyeData.pupilX) * smoothingFactor;
        eyeData.pupilY += (targetY - eyeData.pupilY) * smoothingFactor;

        eyeData.pupil.style.transform = `translate(${eyeData.pupilX}px, ${eyeData.pupilY}px)`;
      });

      requestAnimationFrame(animate);
    }

    resetGame();
    animate();

    restartBtn.addEventListener("click", () => {
      resetGame();
    });
  </script>

</body>
</html>
