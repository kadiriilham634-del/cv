<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Les yeux — mini jeu Junji Ito</title>

  <!-- Police un peu élégante / morbide -->
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&family=Roboto+Mono:wght@300;400&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #050505;
      --blood: #b00020;
      --blood-soft: #4b0010;
      --text: #f5f5f5;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: radial-gradient(circle at center, #141414 0%, #050505 55%, #000 100%);
      min-height: 100vh;
      overflow: hidden;
      font-family: "Cormorant Garamond", serif;
      color: var(--text);
      position: relative;
    }

    /* Grain + lignes inquiétantes */
    body::before {
      content: "";
      position: fixed;
      inset: -40px;
      pointer-events: none;
      background:
        repeating-linear-gradient(
          to bottom,
          rgba(255, 255, 255, 0.02) 0px,
          rgba(255, 255, 255, 0.01) 2px,
          rgba(0, 0, 0, 0.4) 4px
        );
      mix-blend-mode: soft-light;
      opacity: 0.7;
      animation: drift 35s linear infinite;
      z-index: 1;
    }

    @keyframes drift {
      0% { transform: translateY(0); }
      100% { transform: translateY(200px); }
    }

    /* Légère “respiration” globale */
    @keyframes breathe {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.01); }
    }

    #scene {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      animation: breathe 12s ease-in-out infinite;
      cursor: crosshair;
      z-index: 2;
    }

    /* Spirale fantôme au centre, Junji Ito */
    #spiral-bg {
      position: absolute;
      width: 420px;
      height: 420px;
      border-radius: 50%;
      border: 2px solid rgba(176, 0, 32, 0.15);
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 0 80px rgba(0,0,0,0.9);
      opacity: 0.4;
      overflow: visible;
      pointer-events: none;
    }

    #spiral-bg::before,
    #spiral-bg::after {
      content: "";
      position: absolute;
      inset: 22px;
      border-radius: 50%;
      border: 2px dashed rgba(176, 0, 32, 0.3);
    }

    #spiral-bg::after {
      inset: 60px;
      border-style: dotted;
      opacity: 0.7;
    }

    @keyframes rotateSpiral {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(720deg); }
    }

    #spiral-bg {
      animation: rotateSpiral 45s linear infinite;
    }

    /* HUD */
    #hud {
      position: fixed;
      top: 16px;
      left: 18px;
      z-index: 3;
      font-family: "Roboto Mono", monospace;
      font-size: 13px;
      background: rgba(0, 0, 0, 0.7);
      padding: 8px 12px;
      border-radius: 4px;
      border: 1px solid rgba(176, 0, 32, 0.5);
      box-shadow: 0 0 18px rgba(0,0,0,0.8);
    }

    #hud span {
      color: var(--blood);
    }

    #hint {
      position: fixed;
      top: 16px;
      right: 18px;
      z-index: 3;
      font-size: 13px;
      font-family: "Cormorant Garamond", serif;
      background: rgba(0, 0, 0, 0.65);
      padding: 8px 12px;
      border-radius: 4px;
      border: 1px solid rgba(255,255,255,0.1);
      max-width: 260px;
      text-align: right;
      line-height: 1.3;
    }

    /* Un œil */
    .eye {
      position: absolute;
      width: 90px;
      height: 54px;
      border-radius: 50%;
      background: radial-gradient(circle at 50% 50%, #fff 0%, #ccc 40%, #999 65%, #111 100%);
      box-shadow:
        0 0 30px rgba(0, 0, 0, 0.9),
        0 0 12px rgba(176, 0, 32, 0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      transform-origin: center;
      transition: transform 0.2s ease-out, opacity 0.25s;
      overflow: hidden;
      cursor: pointer;
      animation: eyePulse 6s ease-in-out infinite;
    }

    @keyframes eyePulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.04); }
    }

    /* paupières */
    .eye::before,
    .eye::after {
      content: "";
      position: absolute;
      left: 0;
      right: 0;
      height: 40%;
      background: radial-gradient(circle at 50% 0%, #111 0%, #050505 40%, transparent 100%);
      opacity: 0.9;
      pointer-events: none;
    }

    .eye::before {
      top: -25%;
    }

    .eye::after {
      bottom: -25%;
      transform: scaleY(-1);
    }

    .eye-ball {
      position: relative;
      width: 38px;
      height: 38px;
      border-radius: 50%;
      background: radial-gradient(circle, #660000 0%, #210000 55%, #000 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 0 18px rgba(176,0,32,0.9);
    }

    .pupil {
      position: relative;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #000;
      box-shadow: 0 0 18px rgba(255,255,255,0.25);
      transition: transform 0.08s linear;
    }

    .pupil::after {
      content: "";
      position: absolute;
      width: 5px;
      height: 5px;
      border-radius: 50%;
      background: rgba(255,255,255,0.7);
      top: 3px;
      left: 4px;
    }

    /* œil "en colère" : quand il reste trop longtemps */
    .eye.awake .eye-ball {
      background: radial-gradient(circle, #9b0000 0%, #2b0000 55%, #000 100%);
      box-shadow: 0 0 25px rgba(255,0,0,0.9);
    }

    .eye.awake {
      animation-duration: 3s;
    }

    /* état "fermé" quand on clique */
    .eye.closed {
      opacity: 0;
      pointer-events: none;
      transform: scale(0.7);
    }

    /* écran de fin */
    #game-over-overlay {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at center, rgba(0,0,0,0.95) 0%, rgba(0,0,0,1) 60%);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: var(--text);
      z-index: 5;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s;
      text-align: center;
      padding: 20px;
    }

    #game-over-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }

    #game-over-overlay h1 {
      font-size: 42px;
      letter-spacing: 0.2em;
      margin-bottom: 14px;
      color: var(--blood);
    }

    #game-over-overlay p {
      font-size: 16px;
      max-width: 420px;
      margin-bottom: 18px;
    }

    #restart {
      margin-top: 6px;
      font-family: "Roboto Mono", monospace;
      font-size: 13px;
      padding: 8px 16px;
      border-radius: 3px;
      border: 1px solid var(--blood);
      background: transparent;
      color: var(--text);
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    #restart:hover {
      background: var(--blood-soft);
    }

  </style>
</head>
<body>

  <div id="scene">
    <div id="spiral-bg"></div>
  </div>

  <div id="hud">
    yeux réduits : <span id="closed-count">0</span><br>
    yeux encore ouverts : <span id="open-count">0</span> / <span id="max-eyes"></span>
  </div>

  <div id="hint">
    Clique sur les yeux pour les faire taire.<br>
    S'ils sont trop nombreux en même temps… ils te remarquent.
  </div>

  <div id="game-over-overlay">
    <h1>GAME OVER</h1>
    <p id="game-over-text"></p>
    <button id="restart">recommencer</button>
  </div>

  <script>
    const scene = document.getElementById("scene");
    const closedCountEl = document.getElementById("closed-count");
    const openCountEl = document.getElementById("open-count");
    const maxEyesEl = document.getElementById("max-eyes");
    const overlay = document.getElementById("game-over-overlay");
    const overlayText = document.getElementById("game-over-text");
    const restartBtn = document.getElementById("restart");

    let mouseX = window.innerWidth / 2;
    let mouseY = window.innerHeight / 2;

    let eyes = [];
    let closedCount = 0;
    let openCount = 0;

    const maxEyes = 12;          // nb max d'yeux tolérés
    const spawnIntervalMs = 1800;
    let spawnIntervalId = null;
    let gameOver = false;

    maxEyesEl.textContent = maxEyes;

    document.addEventListener("mousemove", (e) => {
      mouseX = e.clientX;
      mouseY = e.clientY;
    });

    function createEye() {
      if (gameOver) return;

      const eye = document.createElement("div");
      eye.classList.add("eye");

      const eyeBall = document.createElement("div");
      eyeBall.classList.add("eye-ball");

      const pupil = document.createElement("div");
      pupil.classList.add("pupil");

      eyeBall.appendChild(pupil);
      eye.appendChild(eyeBall);
      scene.appendChild(eye);

      // Position aléatoire, mais en évitant trop le centre exact
      const padding = 40;
      const w = window.innerWidth;
      const h = window.innerHeight;

      let x = Math.random() * (w - 2 * padding) + padding;
      let y = Math.random() * (h - 2 * padding) + padding;

      eye.style.left = `${x}px`;
      eye.style.top = `${y}px`;

      const eyeData = {
        el: eye,
        pupil,
        awake: false
      };

      eyes.push(eyeData);
      openCount++;
      updateHud();

      // Après un moment, l’œil devient "awake"
      const awakeTimeout = setTimeout(() => {
        if (!gameOver && !eye.classList.contains("closed")) {
          eye.classList.add("awake");
          eyeData.awake = true;
          checkGameOver();
        }
      }, 4000 + Math.random() * 2000);

      eyeData.awakeTimeout = awakeTimeout;

      // Click = fermer l'œil
      eye.addEventListener("click", () => {
        if (gameOver || eye.classList.contains("closed")) return;
        eye.classList.add("closed");
        clearTimeout(awakeTimeout);
        setTimeout(() => {
          eye.remove();
        }, 260);
        openCount--;
        closedCount++;
        updateHud();
      });
    }

    function updateHud() {
      closedCountEl.textContent = closedCount;
      openCountEl.textContent = openCount;
      checkGameOver();
    }

    function checkGameOver() {
      if (openCount >= maxEyes && !gameOver) {
        triggerGameOver();
      }
    }

    function triggerGameOver() {
      gameOver = true;
      clearInterval(spawnIntervalId);

      const texts = [
        "Tu en as fermé quelques-uns, mais les autres te regardaient déjà depuis l'intérieur.",
        "Tu croyais les faire taire. Ils attendaient seulement que tu clignes des yeux.",
        "Tu n'as pas perdu le jeu. Tu as simplement découvert que tu n'étais pas seul devant l'écran."
      ];
      overlayText.textContent = texts[Math.floor(Math.random() * texts.length)];

      overlay.classList.add("show");
    }

    function resetGame() {
      gameOver = false;

      eyes.forEach(e => {
        clearTimeout(e.awakeTimeout);
        e.el.remove();
      });
      eyes = [];
      closedCount = 0;
      openCount = 0;
      updateHud();

      overlay.classList.remove("show");

      // relancer le spawn
      spawnIntervalId = setInterval(createEye, spawnIntervalMs);
      // créer quelques yeux de base
      for (let i = 0; i < 3; i++) createEye();
    }

    // Boucle qui fait suivre la pupille vers la souris
    function animatePupils() {
      eyes.forEach((eyeData) => {
        const rect = eyeData.el.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;

        const dx = mouseX - centerX;
        const dy = mouseY - centerY;
        const angle = Math.atan2(dy, dx);
        const maxOffset = eyeData.awake ? 9 : 7;

        const offsetX = Math.cos(angle) * maxOffset;
        const offsetY = Math.sin(angle) * maxOffset;

        eyeData.pupil.style.transform = `translate(${offsetX}px, ${offsetY}px)`;
      });

      requestAnimationFrame(animatePupils);
    }

    // Lancer jeu
    resetGame();
    animatePupils();

    restartBtn.addEventListener("click", () => {
      resetGame();
    });
  </script>

</body>
</html>
